-- Mac OS X El Capitan 10.11.6
-- Adapted from these sources:
-- http://peterdowns.com/posts/open-iterm-finder-service.html
-- https://gist.github.com/cowboy/905546
-- https://gist.github.com/shuntaroy/e5ce3ad61c0deb7e27f0
-- Modified to work with files as well, cd-ing to their container folder

on run {input, parameters}
	tell application "Finder"
		set my_file to first item of input
		set filetype to (kind of (info for my_file))
		-- Treats OS X applications as files.  To treat them as folders, integrate this SO answer:
		-- http://stackoverflow.com/a/6881524/640517
		set dir_path to quoted form of (POSIX path of my_file)
	end tell
	CD_to(dir_path)
end run

on CD_to(theDir)
	tell application "iTerm"
		activate
		set go_dir to "cd " & theDir
		set newWindow to (create window with default profile)
		tell current session of first window
			write text go_dir
		end tell
	end tell
end CD_to
